const{Client:Client,EmbedBuilder:EmbedBuilder,GatewayIntentBits:GatewayIntentBits,ActionRowBuilder:ActionRowBuilder,ButtonStyle:ButtonStyle,ButtonBuilder:ButtonBuilder}=require("discord.js"),fs=require("fs"),path=require("path"),colors=require("colors"),{token:token,ownerID:ownerID,rateLimitDelay:rateLimitDelay,prefix:prefix}=require("./config.json"),client=new Client({intents:[GatewayIntentBits.Guilds,GatewayIntentBits.GuildMembers,GatewayIntentBits.DirectMessages,GatewayIntentBits.GuildMessages,GatewayIntentBits.MessageContent]});let successLog=[],failLog=[],rateLimitDelayy=rateLimitDelay;const Grup_Batch=10,handleRateLimit=async(e,t=3)=>{for(let l=1;l<=t;l++)try{return await new Promise((e=>setTimeout(e,rateLimitDelayy))),await e()}catch(e){if(!e.message.includes("rate limit"))throw 50007===e.code?new Error("DM KapalÄ±"):e;console.log(`Rate limit algÄ±landÄ±. ${l}. deneme yapÄ±lÄ±yor...`),rateLimitDelayy+=500}throw new Error("Rate limit denemeleri baÅŸarÄ±sÄ±z oldu.")};client.once("ready",(()=>{function e(e,t){const l=[...e].length,a=Math.max(0,Math.floor((t-2-l)/2));return" ".repeat(a)+e+" ".repeat(t-2-l-a)}!async function(t){const l=t.user?.tag||"MNG Airlines Bot",a=t.guilds?.cache?.size||0,n=t.guilds?.cache?.reduce(((e,t)=>e+t.memberCount),0)||0,o=process.stdout.columns||80,i=Math.min(36,Math.floor(o/2)-2),r=new Date,s=`${r.getDate().toString().padStart(2,"0")}.${(r.getMonth()+1).toString().padStart(2,"0")}.${r.getFullYear()} - ${r.getHours().toString().padStart(2,"0")}:${r.getMinutes().toString().padStart(2,"0")}`,d=["â•”".blue.bold+"â•".repeat(i-2).blue.bold+"â•—".blue.bold,"â•‘".blue.bold+" ".repeat(i-2).blue.bold+"â•‘".blue.bold,"â•‘".blue.bold+e("MNG Airlines DM Duyuru âœˆï¸",i).white.bold+"â•‘".blue.bold,"â•‘".blue.bold+e(s,i).white.bold+"â•‘".blue.bold,"â•‘".blue.bold+" ".repeat(i-2).blue.bold+"â•‘".blue.bold,"â•‘".blue.bold+" ".repeat(i-2).blue.bold+"â•‘".blue.bold,"â•š".blue.bold+"â•".repeat(i-2).blue.bold+"â•".blue.bold],u=["â•”".magenta.bold+"â•".repeat(i-2).magenta.bold+"â•—".magenta.bold,"â•‘".magenta.bold+" ".repeat(i-2).magenta.bold+"â•‘".magenta.bold,"â•‘".magenta.bold+e(`Bot: ${l}`,i).cyan.bold+"â•‘".magenta.bold,"â•‘".magenta.bold+e(`Sunucular: ${a}`,i).yellow.bold+"â•‘".magenta.bold,"â•‘".magenta.bold+e(`KullanÄ±cÄ±lar: ${n}`,i).green.bold+"â•‘".magenta.bold,"â•‘".magenta.bold+" ".repeat(i-2).magenta.bold+"â•‘".magenta.bold,"â•š".magenta.bold+"â•".repeat(i-2).magenta.bold+"â•".magenta.bold],m=Math.max(d.length,u.length);for(let e=0;e<m;e++){const t=e<d.length?d[e]:" ".repeat(i),l=e<u.length?u[e]:" ".repeat(i);console.log(t+"  "+l)}}(client);const t=72,l="MNG Airlines | DM Duyuru";console.log("â•”".yellow.bold+"â•".repeat(t).yellow.bold+"â•—".yellow.bold);const a=Math.floor(24);console.log("â•‘".yellow.bold+" ".repeat(a)+l.magenta.bold+" ".repeat(48-a)+"â•‘".yellow.bold),console.log("â•‘".yellow.bold+" ".repeat(t)+"â•‘".yellow.bold);const n="daha fazla proje yada satÄ±n alÄ±m / bot yaptÄ±rma iÃ§in discord sunucumuza gelin https://discord.gg/h7YAermnyw".split(" ");let o="";for(const e of n)if(o.length+e.length+1<=t)o+=(o?" ":"")+e;else{const l=Math.floor((t-o.length)/2);console.log("â•‘".yellow.bold+" ".repeat(l)+o.white.bold+" ".repeat(t-o.length-l)+"â•‘".yellow.bold),o=e}if(o){const e=Math.floor((t-o.length)/2);console.log("â•‘".yellow.bold+" ".repeat(e)+o.white.bold+" ".repeat(t-o.length-e)+"â•‘".yellow.bold)}console.log("â•š".yellow.bold+"â•".repeat(t).yellow.bold+"â•".yellow.bold)})),client.on("messageCreate",(async e=>{if(!e.guild||e.author.bot)return;const t=e.content.split(/ +/),l=t.shift().toLowerCase();if(e.author.id===ownerID){if(l===`${prefix}dm`){const l=/^<@!?(\d+)>$/,a=e.mentions.users.first();if(!a||!l.test(t[0]))return e.reply(`âŒ **HATA:** GeÃ§erli bir kullanÄ±cÄ± etiketlemelisiniz!\nÃ–rnek: \`${prefix}dm @KullanÄ±cÄ± Merhaba\``);const n=t.slice(1).join(" ").trim();if(!n)return e.reply("âŒ **HATA:** GÃ¶ndereceÄŸiniz mesajÄ± yazmalÄ±sÄ±nÄ±z!");try{return await a.send(n),e.reply(`âœ… Mesaj sadece ${a} kullanÄ±cÄ±sÄ±na iletildi!`)}catch(t){return e.reply(`âŒ ${a} kullanÄ±cÄ±sÄ±na mesaj iletilemedi! (DM'leri kapalÄ± olabilir)`)}}if(l===`${prefix}dmherkes`){const l=t.join(" ").trim();if(!l)return e.reply({content:"âŒ GÃ¶ndermek istediÄŸiniz mesajÄ± yazmalÄ±sÄ±nÄ±z!"});const a=(await e.guild.members.fetch({cache:!0})).filter((e=>!e.user.bot)),n=a.size;let o=0,i=0,r=!1,s=0;const d=(new EmbedBuilder).setColor(5793266).setTitle("ğŸ“¢ TOPLU DM GÃ–NDERÄ°MÄ°").setDescription([`**Hedef:** TÃ¼m sunucu (${n} kiÅŸi)`,"**Durum:** BaÅŸlatÄ±lÄ±yor...",`**Ä°lerleme:** 0/${n} (0%)`,`**Kalan:** ${n} kiÅŸi`].join("\n")).addFields({name:"âœ… BaÅŸarÄ±lÄ±",value:"```0```",inline:!0},{name:"âŒ BaÅŸarÄ±sÄ±z",value:"```0```",inline:!0}).setFooter({text:`${e.author.tag} | ${e.guild.name}`,iconURL:e.author.displayAvatarURL()}),u=(new ActionRowBuilder).addComponents((new ButtonBuilder).setCustomId("lweaxo_duyuru_bot").setDisabled(!0).setEmoji({name:"ğŸ“¢"}).setLabel("Toplu DM").setStyle(ButtonStyle.Secondary),(new ButtonBuilder).setCustomId("cancel_dm").setLabel("Ä°ptal Et").setStyle(ButtonStyle.Danger).setEmoji("âœ–ï¸")),m=await e.channel.send({embeds:[d],components:[u]}),c=m.createMessageComponentCollector({filter:t=>t.user.id===e.author.id,time:36e5});c.on("collect",(async e=>{"cancel_dm"===e.customId&&(r=!0,s=Math.round((o+i)/n*100),await e.update({content:`âŒ GÃ¶nderim iptal edildi! (Tamamlanan: ${s}%)`,components:[(new ActionRowBuilder).addComponents((new ButtonBuilder).setCustomId("lweaxo_duyuru_bot").setDisabled(!0).setEmoji({name:"ğŸ“¢"}).setLabel("Toplu DM").setStyle(ButtonStyle.Secondary),(new ButtonBuilder).setCustomId("cancel_dm").setDisabled(!0).setLabel("Ä°ptal Edildi").setStyle(ButtonStyle.Danger))]}),c.stop())}));const b=async()=>{s=Math.round((o+i)/n*100),d.setDescription([`**Hedef:** TÃ¼m sunucu (${n} kiÅŸi)`,"**Durum:** "+(r?"Ä°ptal Edildi":"Devam Ediyor"),`**Ä°lerleme:** ${o+i}/${n} (${s}%)`,`**Kalan:** ${n-(o+i)} kiÅŸi`].join("\n")),d.setFields({name:"âœ… BaÅŸarÄ±lÄ±",value:`\`\`\`${o.toString()}\`\`\``,inline:!0},{name:"âŒ BaÅŸarÄ±sÄ±z",value:`\`\`\`${i.toString()}\`\`\``,inline:!0}),await m.edit({embeds:[d],components:[(new ActionRowBuilder).addComponents((new ButtonBuilder).setCustomId("lweaxo_duyuru_bot").setDisabled(!0).setEmoji({name:"ğŸ“¢"}).setLabel("Toplu DM").setStyle(ButtonStyle.Secondary),(new ButtonBuilder).setCustomId("cancel_dm").setLabel(r?"Ä°ptal Edildi":"Ä°ptal Et").setStyle(ButtonStyle.Danger).setDisabled(r).setEmoji("âœ–ï¸"))]})},y=Array.from(a.values());for(let e=0;e<y.length&&!r;e++){try{await y[e].send(l),o++}catch(e){i++}e%10!=0&&e!==y.length-1||(await b(),r||e%40!=0||await new Promise((e=>setTimeout(e,rateLimitDelayy))))}r||(d.setTitle("âœ… GÃ–NDERÄ°M TAMAMLANDI").setColor(5763719).setDescription([`**Hedef:** TÃ¼m sunucu (${n} kiÅŸi)`,"**Durum:** âœ… TamamlandÄ±",`**Tamamlanma:** ${s}%`,`**SÃ¼re:** ${Math.round((Date.now()-m.createdTimestamp)/1e3)} saniye`].join("\n")).setFields({name:"âœ… BaÅŸarÄ±lÄ±",value:`\`\`\`${o.toString()}\`\`\``,inline:!0},{name:"âŒ BaÅŸarÄ±sÄ±z",value:`\`\`\`${i.toString()}\`\`\``,inline:!0}),await m.edit({embeds:[d],components:[(new ActionRowBuilder).addComponents((new ButtonBuilder).setCustomId("lweaxo_duyuru_bot").setDisabled(!0).setEmoji({name:"ğŸ“¢"}).setLabel("Toplu DM").setStyle(ButtonStyle.Secondary),(new ButtonBuilder).setCustomId("islem_tamam_mng_airlines").setLabel("Ä°ÅŸlem TamamlandÄ±!").setEmoji("âœ…").setStyle(ButtonStyle.Secondary).setDisabled(!0))]}));const g=[`=== ${(new Date).toLocaleString("tr-TR")} ===`,`Yetkili: ${e.author.tag} (${e.author.id})`,`Sunucu: ${e.guild.name} (${e.guild.id})`,`Mesaj: "${l}"`,`Hedeflenen: ${n} kiÅŸi`,`BaÅŸarÄ±lÄ±: ${o}`,`BaÅŸarÄ±sÄ±z: ${i}`,`Tamamlanma: ${s}%`,"Durum: "+(r?"Ä°PTAL":"TAMAMLANDI"),`SÃ¼re: ${Math.round((Date.now()-m.createdTimestamp)/1e3)} sn`,"=== SON ===\n"].join("\n"),p=path.join(__dirname,"logs");fs.existsSync(p)||fs.mkdirSync(p,{recursive:!0});const w=path.join(p,`dm_${e.guild.id}_${Date.now()}.txt`);fs.writeFileSync(w,g)}if(l===`${prefix}yardÄ±m`){const t=(new EmbedBuilder).setDescription(`\n**${prefix}dm @etiket mesaj** â†’ Sadece etiketlenen kiÅŸiye DM atar\n\n**${prefix}dmherkes mesaj** â†’ TÃ¼m sunucuya DM atar (botlar hariÃ§)\n\n**${prefix}yardÄ±m** â†’ Bu menÃ¼yÃ¼ gÃ¶sterir`).setColor("Purple").setTimestamp(),l=(new ActionRowBuilder).addComponents((new ButtonBuilder).setCustomId("mng_airlines_lweaxo").setDisabled(!0).setEmoji("ğŸ“¢").setLabel("Dm Duyuru").setStyle(ButtonStyle.Secondary));e.reply({embeds:[t],components:[l]})}}})),client.login(token);