const{Client:Client,EmbedBuilder:EmbedBuilder,GatewayIntentBits:GatewayIntentBits,ActionRowBuilder:ActionRowBuilder,ButtonStyle:ButtonStyle,ButtonBuilder:ButtonBuilder}=require("discord.js"),fs=require("fs"),path=require("path"),colors=require("colors"),{token:token,ownerID:ownerID}=require("./config.json"),client=new Client({intents:[GatewayIntentBits.Guilds,GatewayIntentBits.GuildMembers,GatewayIntentBits.DirectMessages,GatewayIntentBits.GuildMessages,GatewayIntentBits.MessageContent]});let successLog=[],failLog=[],rateLimitDelay=2500;const handleRateLimit=async(e,t=3)=>{for(let l=1;l<=t;l++)try{return await new Promise((e=>setTimeout(e,rateLimitDelay))),await e()}catch(e){if(!e.message.includes("rate limit"))throw 50007===e.code?new Error("DM KapalÄ±"):e;console.log(`Rate limit algÄ±landÄ±. ${l}. deneme yapÄ±lÄ±yor...`),rateLimitDelay+=500}throw new Error("Rate limit denemeleri baÅŸarÄ±sÄ±z oldu.")};client.once("ready",(()=>{function e(e,t){const l=[...e].length,n=Math.max(0,Math.floor((t-2-l)/2));return" ".repeat(n)+e+" ".repeat(t-2-l-n)}!async function(t){const l=t.user?.tag||"MNG Airlines Bot",n=t.guilds?.cache?.size||0,o=t.guilds?.cache?.reduce(((e,t)=>e+t.memberCount),0)||0,a=process.stdout.columns||80,i=Math.min(36,Math.floor(a/2)-2),s=new Date,r=`${s.getDate().toString().padStart(2,"0")}.${(s.getMonth()+1).toString().padStart(2,"0")}.${s.getFullYear()} - ${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`,d=["â•”".blue.bold+"â•".repeat(i-2).blue.bold+"â•—".blue.bold,"â•‘".blue.bold+" ".repeat(i-2).blue.bold+"â•‘".blue.bold,"â•‘".blue.bold+e("MNG Airlines DM Duyuru âœˆï¸",i).white.bold+"â•‘".blue.bold,"â•‘".blue.bold+e(r,i).white.bold+"â•‘".blue.bold,"â•‘".blue.bold+" ".repeat(i-2).blue.bold+"â•‘".blue.bold,"â•‘".blue.bold+" ".repeat(i-2).blue.bold+"â•‘".blue.bold,"â•š".blue.bold+"â•".repeat(i-2).blue.bold+"â•".blue.bold],u=["â•”".magenta.bold+"â•".repeat(i-2).magenta.bold+"â•—".magenta.bold,"â•‘".magenta.bold+" ".repeat(i-2).magenta.bold+"â•‘".magenta.bold,"â•‘".magenta.bold+e(`Bot: ${l}`,i).cyan.bold+"â•‘".magenta.bold,"â•‘".magenta.bold+e(`Sunucular: ${n}`,i).yellow.bold+"â•‘".magenta.bold,"â•‘".magenta.bold+e(`KullanÄ±cÄ±lar: ${o}`,i).green.bold+"â•‘".magenta.bold,"â•‘".magenta.bold+" ".repeat(i-2).magenta.bold+"â•‘".magenta.bold,"â•š".magenta.bold+"â•".repeat(i-2).magenta.bold+"â•".magenta.bold],m=Math.max(d.length,u.length);for(let e=0;e<m;e++){const t=e<d.length?d[e]:" ".repeat(i),l=e<u.length?u[e]:" ".repeat(i);console.log(t+"  "+l)}}(client);const t=72,l="MNG Airlines | DM Duyuru";console.log("â•”".yellow.bold+"â•".repeat(t).yellow.bold+"â•—".yellow.bold);const n=Math.floor(24);console.log("â•‘".yellow.bold+" ".repeat(n)+l.magenta.bold+" ".repeat(48-n)+"â•‘".yellow.bold),console.log("â•‘".yellow.bold+" ".repeat(t)+"â•‘".yellow.bold);const o="daha fazla proje yada satÄ±n alÄ±m / bot yaptÄ±rma iÃ§in discord sunucumuza gelin https://discord.gg/h7YAermnyw".split(" ");let a="";for(const e of o)if(a.length+e.length+1<=t)a+=(a?" ":"")+e;else{const l=Math.floor((t-a.length)/2);console.log("â•‘".yellow.bold+" ".repeat(l)+a.white.bold+" ".repeat(t-a.length-l)+"â•‘".yellow.bold),a=e}if(a){const e=Math.floor((t-a.length)/2);console.log("â•‘".yellow.bold+" ".repeat(e)+a.white.bold+" ".repeat(t-a.length-e)+"â•‘".yellow.bold)}console.log("â•š".yellow.bold+"â•".repeat(t).yellow.bold+"â•".yellow.bold)})),client.on("messageCreate",(async e=>{if(!e.guild||e.author.bot)return;const t=e.content.split(" "),l=t.shift().toLowerCase();if(e.author.id!==ownerID&&l.startsWith("!"))return e.reply("Bu komutu kullanma yetkiniz yok!");if("!dm"===l||"!dmherkes"===l){const n="!dm"===l?t.filter((e=>isNaN(e)&&!e.startsWith("<@"))).join(" "):t.join(" ");if(!n)return e.reply({content:"âŒ GÃ¶ndermek istediÄŸiniz mesajÄ± yazmalÄ±sÄ±nÄ±z!"});const o=await e.guild.members.fetch({cache:!0}),a=o.filter((e=>!e.user.bot)).size;let i=[],s=[],r=Math.min(parseInt(t.find((e=>!isNaN(e))),10)||a,a),d=0,u=!1;const m=(new EmbedBuilder).setColor(16753920).setTitle("ğŸ“¨ Toplu DM GÃ¶nderimi").setDescription(["**Durum:** BaÅŸlatÄ±lÄ±yor...",`**Ä°lerleme:** 0/${r} (0%)`,`**Kalan:** ${r} kiÅŸi`].join("\n")).addFields({name:"âœ… BaÅŸarÄ±lÄ±",value:"0",inline:!0},{name:"âŒ BaÅŸarÄ±sÄ±z",value:"0",inline:!0}).setFooter({text:`${e.author.tag} | ${e.guild.name}`,iconURL:e.author.displayAvatarURL()}).setTimestamp(),c=(new ActionRowBuilder).addComponents((new ButtonBuilder).setCustomId("lweaxo_duyuru_bot").setDisabled(!0).setEmoji({name:"ğŸ“¢"}).setLabel("Dm Duyuru").setStyle(ButtonStyle.Secondary),(new ButtonBuilder).setCustomId("cancel_dm").setEmoji({name:"âŒ"}).setLabel("Ä°ptal").setStyle(ButtonStyle.Danger)),b=await e.channel.send({embeds:[m],components:[c]}),g=t=>"cancel_dm"===t.customId&&t.user.id===e.author.id,y=b.createMessageComponentCollector({filter:g,time:36e5});y.on("collect",(async e=>{u=!0,await e.update({content:"âŒ DM gÃ¶nderimi iptal edildi!",components:[(new ActionRowBuilder).addComponents((new ButtonBuilder).setCustomId("lweaxo_duyuru_bot").setDisabled(!0).setEmoji({name:"ğŸ“¢"}).setLabel("Dm Duyuru").setStyle(ButtonStyle.Secondary),(new ButtonBuilder).setCustomId("cancel_dm").setEmoji({name:"âŒ"}).setDisabled(!0).setLabel("Ä°ptal").setStyle(ButtonStyle.Danger))]}),y.stop()}));const p=async(e=!1)=>{const t=Math.round(d/r*100),l=r-d;m.setDescription([`**Durum:** ${e?"TamamlandÄ±":u?"Ä°ptal Edildi":"Devam ediyor"}...`,`**Ä°lerleme:** ${d}/${r} (${t}%)`,`**Kalan:** ${e?"0":l} kiÅŸi`].join("\n")),m.setFields({name:"âœ… BaÅŸarÄ±lÄ±",value:i.length.toString(),inline:!0},{name:"âŒ BaÅŸarÄ±sÄ±z",value:s.length.toString(),inline:!0}),(e||u)&&m.setColor(u?16711680:0===s.length?65280:s.length===r?16711680:16753920),await b.edit({embeds:[m],components:[(new ActionRowBuilder).addComponents((new ButtonBuilder).setCustomId("lweaxo_duyuru_bot").setDisabled(!0).setEmoji({name:"ğŸ“¢"}).setLabel("Dm Duyuru").setStyle(ButtonStyle.Secondary),(new ButtonBuilder).setCustomId("cancel_dm").setEmoji({name:"âŒ"}).setDisabled(!0).setLabel("Ä°ptal").setStyle(ButtonStyle.Danger))]})},w=10,h=3e3,B=o.filter((e=>!e.user.bot)).first(r);for(let e=0;e<B.length&&!u;e++){const t=B[e];try{if(e>0&&e%w==0&&(await p(),await new Promise((e=>setTimeout(e,h))),u))break;await t.send({content:n}),i.push(t.user.tag),d++}catch(e){const l=50007===e.code?"DM KapalÄ±":e.message.includes("rate limited")?"Rate Limit":e.message.slice(0,50);s.push(`${t.user.tag} (${l})`)}(e%5==0||e===B.length-1||u)&&await p(e===B.length-1||u)}const D=[`=== ${(new Date).toLocaleString()} ===`,`Komutu Kullanan: ${e.author.tag} (${e.author.id})`,`Sunucu: ${e.guild.name} (${e.guild.id})`,`GÃ¶nderilen Mesaj: "${n.slice(0,50)}${n.length>50?"...":""}"`,`Toplam: ${r} kiÅŸi`,`BaÅŸarÄ±lÄ±: ${i.length}`,`BaÅŸarÄ±sÄ±z: ${s.length}`,"Ä°ptal Edildi: "+(u?"Evet":"HayÄ±r"),`\nBAÅARILI KULLANICILAR:\n${i.join("\n")}`,`\nBAÅARISIZ KULLANICILAR:\n${s.join("\n")}`,"\n=== SON ===\n"].join("\n"),S=`dm_logs_${(new Date).toISOString().split("T")[0]}.txt`,f=path.join(__dirname,"logs",S);fs.mkdirSync(path.dirname(f),{recursive:!0}),fs.appendFileSync(f,D)}if("!yardÄ±m"===l){if(e.author.id!==ownerID&&l.startsWith("!"))return e.reply("Bu komutu kullanma yetkiniz yok!");const t=(new EmbedBuilder).setDescription("\n**!dm <@etiket> <mesaj>** **__|__** `SeÃ§ili kiÅŸiye dm mesajÄ± gÃ¶nderir.`\n**!dmherkes <mesaj>** **__|__** `Sunucudaki herkese dm mesajÄ± gÃ¶nderir.`\n**!yardÄ±m** **__|__** `komutlarÄ± gÃ¶sterir.`").setColor("Purple").setTimestamp(),n=(new ActionRowBuilder).addComponents((new ButtonBuilder).setCustomId("mng_airlines_lweaxo").setDisabled(!0).setEmoji({name:"ğŸ“¢"}).setLabel("Dm Duyuru").setStyle(ButtonStyle.Secondary));e.reply({embeds:[t],components:[n]})}})),client.login(token);